<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="author" content="Tamayan / ZebraSoft">
	<meta name="copyright" content="¬© 2025 Tamayan / ZebraSoft">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" href="favicon.ico">
	<title>SLP-SlideLooperPuzzle2</title>
	<link rel="stylesheet" href="css/base-theme.css?v=1.0.0">
	<link rel="stylesheet" href="css/board-layout.css?v=1.0.0">
	<link rel="stylesheet" href="css/gimmick-effects.css?v=1.0.0">
	<link rel="stylesheet" href="css/ui-components.css?v=1.0.0">
	<link rel="manifest" href="./manifest.json">
	<script>
		if ('serviceWorker' in navigator && location.protocol.startsWith('http')) {
			navigator.serviceWorker.register('./sw.js')
				.then(reg => console.log('SW registered'))
				.catch(err => console.error('SW failed', err));
		}
	</script>
</head>

<body>
	<div class="main-header">
		<div class="title-container" onclick="toggleMenu()">
			<span class="title-text">SLP Slide Looper Puzzle</span>
		</div>
		<div class="header-side-right">
			<button id="menu-dots" onclick="toggleMenu()" aria-label="Menu">&#8942;</button>
		</div>
	</div>
	<div class="menu-panel neon-overlay" id="menu-panel">
		<button id="log-switch-btn" class="log-switch-btn active-rec" onclick="toggleLogSwitch()"
			title="Toggle Log Recording">
			<span id="log-check-icon">‚òë</span> REC
		</button>

		<button id="menu-log" class="icon-btn" onclick="toggleLogPanel()" title="View LOG">
			<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
				<polyline points="14 2 14 8 20 8"></polyline>
				<line x1="16" y1="13" x2="8" y2="13"></line>
				<line x1="16" y1="17" x2="8" y2="17"></line>
				<polyline points="10 9 9 9 8 9"></polyline>
			</svg>
		</button>

		<label for="mode-select" class="v-hidden">Grid Size:</label>
		<select id="mode-select" class="neon-select" onchange="handleModeChange(this.value)"
			title="Grid Size Selection">
			<option value="easy">Easy 2(4x4)</option>
			<option value="mid" selected="">Middle 2(6x6)</option>
			<option value="hard">Hard 3(9x9)</option>
			<option value="advance">Advance 2(8x8)</option>
		</select>

		<div class="scramble-composite-box">
			<label for="scramble-count" class="v-hidden">Scramble Count:</label>
			<input type="number" id="scramble-count" class="scramble-number-field" value="15" min="1" max="200">
			<button class="scramble-exec-btn" onclick="shuffle()" title="Scramble">
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
					stroke-linejoin="round">
					<polyline points="16 3 21 3 21 8"></polyline>
					<line x1="4" y1="20" x2="21" y2="3"></line>
					<polyline points="21 16 21 21 16 21"></polyline>
					<line x1="15" y1="15" x2="21" y2="21"></line>
					<line x1="4" y1="4" x2="9" y2="9"></line>
				</svg>
			</button>
		</div>

		<button class="icon-btn" onclick="initBoard()" title="Reset">
			<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
				<polyline points="3 3 3 8 8 8"></polyline>
			</svg>
		</button>
	</div>

	<div id="media-controls" class="media-overlay-top">
		<div class="m-group">
			<button class="m-btn" onclick="replayStepBack()">‚óÄ Back</button>
			<button class="m-btn stop" onclick="toggleReplayMode()">‚ñ† Exit</button>
			<button class="m-btn" onclick="replayStepNext()">Next ‚ñ∂</button>
		</div>
		<div class="replay-status">
			<div class="analyze-slider-container">
				<input type="range" id="analyze-slider" min="0" value="0" 
					aria-label="Replay seek bar">
			</div>
			<div class="replay-info-text">
				<span id="current-move-display">---</span>
				<span class="step-label">STEP: <span id="replay-index">0</span> / <span id="replay-total">0</span></span>
			</div>
		</div>
	</div>
	<div id="v2-media-uploader" class="media-overlay-top"
		style="display: none; border: 1px solid #0f0; background: rgba(0, 40, 0, 0.9); box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);">
		<div class="m-group">
			<input type="file" id="media-upload" accept="image/*,video/*" style="display: none;" onchange="handleMediaUpload(event)" aria-label="Upload image or video file">
			<button class="m-btn" onclick="document.getElementById('media-upload').click()">üìÅ Load</button>
			<button class="m-btn stop" onclick="resetToColorMode()">üé® Reset</button>
		</div>
		<div style="font-size: 9px; color: #0f0; margin-bottom: 5px; opacity: 0.8; text-align: center;">
			Supports Image & MP4 Video files
		</div>
		<div class="replay-status"
			style="border-top: 1px solid rgba(0, 255, 0, 0.3); padding-top: 5px; color: #0f0; text-shadow: 0 0 5px #0f0;">
			V2 MODE: <span id="current-v2-mode">COLOR</span>
		</div>
	</div>

	<div id="v2-video-uploader" class="v2-panel"
		style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; border: 1px solid #0f0; background: rgba(0, 20, 0, 0.95); color: #0f0; width: 280px; box-shadow: 0 0 20px rgba(0,255,0,0.5);">

		<div class="v2-panel-header"
			style="border-bottom: 1px solid #0f0; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
			<span>VIDEO SETTINGS</span>
			<button onclick="toggleVideoPanel()"
				style="background: none; border: none; color: #0f0; font-size: 20px; cursor: pointer; padding: 0 5px;">&times;</button>
		</div>

		<div class="v2-panel-body" style="padding: 20px;">
			<div style="margin-bottom: 5px; font-size: 11px; letter-spacing: 1px;">PLAYBACK SPEED</div>
			<div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
				<input type="range" id="speed-slider" min="0.1" max="3.0" step="0.1" value="1.0"
					aria-label="Playback Speed" style="flex-grow: 1; accent-color: #0f0;"
					oninput="if(window.mediaManager) { window.mediaManager.setPlaybackRate(this.value); document.getElementById('speed-val').innerText = parseFloat(this.value).toFixed(1) + 'x'; }">
				<span id="speed-val" style="font-family: monospace; min-width: 40px; text-align: right;">1.0x</span>
			</div>

			<div style="margin-bottom: 5px; font-size: 11px; letter-spacing: 1px;">VOLUME</div>
			<div style="display: flex; align-items: center; gap: 15px;">
				<input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0" aria-label="Volume Level"
					style="flex-grow: 1; accent-color: #0f0;"
					oninput="if(window.mediaManager) { window.mediaManager.setVolume(this.value); document.getElementById('volume-val').innerText = Math.round(this.value * 100) + '%'; }">
				<span id="volume-val" style="font-family: monospace; min-width: 40px; text-align: right;">0%</span>
			</div>

			<p style="font-size: 9px; margin-top: 20px; opacity: 0.6; text-align: center;">Tap [√ó] to close this panel.
			</p>
		</div>
	</div>
	<input type="file" id="v2-video-input" accept="video/*" onchange="handleVideoUpload(event)" 
       style="display:none;" aria-label="Video upload">

	<div id="log-overlay" class="overlay">
		<div class="log-panel">
			<div id="mode-display-neon" style="text-align: center; margin-bottom: 5px;">
				<span id="current-mode-badge"
					style="color:#0f0; border:2px solid #0f0; padding:4px 15px; border-radius:20px; font-weight:bold; box-shadow:0 0 10px #0f0;">
					MODE: <span id="mode-text">-- x --</span>
				</span>
			</div>

			<div id="history-gimmick-display"
				style="display:flex; gap:15px; justify-content:center; padding:10px; background:#222; border-radius:5px; margin-bottom:5px; font-size:24px;">
				<span class="g-icon" id="g-rotate" style="opacity:0.3;">üîÑ</span>
				<span class="g-icon" id="g-spotlight" style="opacity:0.3;">üî¶</span>
				<span class="g-icon" id="g-flash" style="opacity:0.3;">‚ö°</span>
			</div>

			<div id="log-error-msg"
				style="color:#ff4444; font-size:12px; height:18px; text-align:center; margin-bottom:5px;"></div>

			<div class="log-section">
				<label for="scramble-input">Scramble Box (Question)</label>
				<input type="text" id="scramble-input" placeholder="A-L1,B-R2,1-U2,3-D1...">
				<div class="log-controls">
					<button onclick="reproduceScramble()" title="Reproduce Scramble">üß© Apply</button>
					<button onclick="triggerImport()" title="Import CSV">üì• Import</button>
					<button onclick="saveCSV('scramble')" title="Save Scramble CSV">üíæ Save</button>
				</div>
			</div>

			<div class="log-section">
				<label for="solve-log">Solve Log (Live Answer)</label>
				<input type="text" id="solve-log" readonly placeholder="Your solve log will appear here">
				<div class="log-controls">
					<button onclick="copySolveToScramble()" title="Apply to Scramble">üìã Copy</button>
					<button onclick="saveCSV('solve')" title="Save Solve Pattern">üíæ Save</button>
					<button id="analyze-btn" onclick="startAnalyzeMode()" style="background:#d35400; flex: 2;"
						title="Analyze This Solve">üîç ANALYZE</button>
				</div>
			</div>

			<div class="log-section">
				<div id="history-label" class="log-label">History (Filtered by Mode)</div>
				
				<div id="history-list" 
					class="history-container"
					role="list"
					aria-labelledby="history-label"
					style="max-height:150px; overflow-y:auto; background:#111; border:1px solid #444; margin-bottom:5px;">
				</div>
				
				<div class="log-controls">
					<button onclick="saveBackupCSV()" title="Backup History">üì§ Backup</button>
					<button onclick="triggerRestore()" title="Restore History CSV">üì• Restore</button>
				</div>
			</div>

			<button class="close-btn" onclick="toggleLogPanel()">Close</button>
			<input type="file" id="import-input" style="display:none" onchange="importCSV(event)" aria-label="Import CSV">
			<input type="file" id="restore-input" style="display:none" onchange="restoreHistory(event)" aria-label="Restore history">
		</div>
	</div>

	<div class="content-wrapper">
		<div class="game-area">
			<div id="axis-top" class="axis-h"></div>
			<div id="axis-left" class="axis-v"></div>
			<div class="board-wrapper" id="board-wrapper">
				<div id="timer-frame" class="fx-frame"></div>
				<div id="counter-frame" class="fx-frame"></div>
				<div id="rotate-frame" class="fx-frame"></div>

				<div id="board" class="grid-container"></div>
				<div id="status-board" class="status-overlay">COMPLETE!</div>
				<div id="searchlight-overlay" class="searchlight-layer"></div>
			</div>
		</div>
		<div class="side-panel">
			<div class="preview-area">
				<div style="font-size: 12px; color: #aaa; margin-bottom: 5px;">TARGET VIEW</div>
				<div class="target-stack">
					<div id="preview"></div>
				</div>
			</div>
			<div class="stats-display">
				<div class="stat-item">
					<span class="label">TIME</span>
					<span id="timer-display">00:00.000</span>
				</div>
				<div class="stat-item">
					<span class="label">MOVE</span>
					<span id="counter-display">0000</span>
				</div>
				<div class="action-icons">
					<button class="icon-btn" onclick="copyCurrentToTarget()" title="Copy">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
							<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
							<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
						</svg>
					</button>
					<button class="icon-btn" onclick="toggleTimer()" title="Timer">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
							<circle cx="12" cy="12" r="10"></circle>
							<polyline points="12 6 12 12 16 14"></polyline>
						</svg>
					</button>
					<button class="icon-btn" id="replay-trigger" onclick="toggleReplayMode()" title="Replay Mode">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
							<polygon points="5 3 19 12 5 21 5 3"></polygon>
						</svg>
					</button>
					<button class="icon-btn" id="rotate-btn" onclick="startRotateCountdown()" title="Rotate">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
							<path d="M23 4v6h-6"></path>
							<path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
						</svg>
					</button>
					<button class="icon-btn" onclick="toggleFlash()" title="Flash">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
							<rect x="3" y="3" width="18" height="18" rx="2" />
							<path d="M3 9h18M3 15h18M9 3v18M15 3v18" />
							<rect x="10" y="4" width="4" height="4" fill="yellow" stroke="white" stroke-width="1" />
						</svg>
					</button>
					<button class="icon-btn" onclick="toggleSearchlight()" title="Searchlight">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
							<rect x="3" y="3" width="18" height="18" rx="2" />
							<path d="M3 9h18M3 15h18M9 3v18M15 3v18" />
							<circle cx="16" cy="12" r="5" stroke="white" stroke-width="2" />
						</svg>
					</button>
					<button class="icon-btn" id="v2-panel-toggle" onclick="toggleV2Panel()" title="Image Mode">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
							<rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
							<circle cx="8.5" cy="8.5" r="1.5"></circle>
							<polyline points="21 15 16 10 5 21"></polyline>
						</svg>
					</button>

					<button class="icon-btn" id="v2-video-toggle" onclick="toggleVideoPanel()" title="Video Mode">
						<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
							<rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
							<polygon points="10 8 15 11 10 14 10 8" fill="white"></polygon>
							<line x1="2" y1="21" x2="22" y2="21"></line>
							<line x1="7" y1="17" x2="7" y2="21"></line>
							<line x1="17" y1="17" x2="17" y2="21"></line>
						</svg>
					</button>
				</div>
			</div>
		</div>
	</div>

	<div class="hint">
		Mobile: Drag (Std) / <b>Long Press</b> (Frame)<br>
		PC: Drag (Std) / <span class="key-indicator">Shift</span> (Frame) / <span class="key-indicator">Ctrl</span>
		(1-Cell)
	</div>

	<script src="js/main.js?v=1.0.1"></script>
	<script src="js/core.js?v=1.0.0"></script>
	<script src="js/ui-render.js?v=1.0.0"></script>
	<script src="js/interaction.js?v=1.0.1"></script>
	<script src="js/media-system.js?v=1.0.0"></script>
	<script src="js/RotationManager.js?v=1.0.0"></script>
	<script>
		if (location.protocol.startsWith('http')) {
			const link = document.createElement('link');
			link.rel = 'manifest';
			link.href = './manifest.json';
			document.head.appendChild(link);
		}
	</script>
</body>

</html>